
# 重构


## 代码坏味道(讲义提纲)

## 一、引言

[重构要首先识别代码坏味道](https://github.com/MagicBowen/refactoring/blob/master/effective-refactoring-1.md#%E5%85%B3%E4%BA%8E%E6%9C%AC%E6%96%87)

### 二、《重构》“坏味道”章节
第一版22种；

第二版24种，有增删，有部分小章节标题优化，更加便于理解；

朱康毅讲义；介绍了其中8种；

### 三、我们如何识别“坏味道”
##### 1、 Kent Beck简单设计原则
> - 通过所有测试（Passes its tests）
> - 尽可能消除重复 (Minimizes duplication)
> - 尽可能清晰表达 (Maximizes clarity)
> - 更少代码元素 (Has fewer elements)

>  以上四个原则的重要程度依次降低。

##### 2、王博：软件演进式设计与领域建模
偶发成本来源
###### 重复带来偶发成本
> - 确保一致性的成本；
> - 散弹式修改带来的成本；
> - 测试范围扩大带来的成本；

###### 难以理解带来的偶发成本
> - 不知道在哪里修改
> - 不知道怎么修改
> - -》
> - 沟通、溯源成本
> - 理解错误导致修改错误引入更大的成本

###### 冗余带来偶发成本
> - 思维负担
> - 过度设计可引入冗余代码 （当前静态检查工具控制的较好）

##### 总结
按以下目标清除代码坏味道
- **消除重复和冗余**，避免过度设计：重复代码、夸夸其谈未来性、
- **提升可读性**：神秘命名、过长函数、过多注释
> - 局部膨胀：过长参数列表、
- **降低耦合**：全局数据、发散式修改与散弹式变化？？、依恋情节、重复的switch(switch惊悚现身)、(令人迷惑的)临时字段、
- 其它：可变数据；
- 数据泥团、基本类型偏执、循环语句、冗余的元素、过长的消息链、中间人、内幕交易、过大的类、异曲同工的类、纯数据类、被拒绝的馈赠；
 

### 四、拓展(重构)
如何重构：
- “两顶帽子”；
- 小步快跑，尽量拆解为小粒度的原子操作，可及时验证、快速恢复。
- “旧的不变，新的创建，一步切换，旧的再见”；

何时重构；

重构方法；

### 附、[《重构》中提到的设计模式](../sw_eng/patterns.md)
